#!/bin/bash

if [[ $1 && $1 == '--help' ]];then
    echo "Update your vagbook: vb-up"
    echo "Update your vagbook with VagBook-CLI: vb-up --self"
    echo "Update Ansible lazy upgrade modules: vb-up --mod (ONLY WORK ON APT INSTALL AT UBUNTU 16.04 LTS)"
    exit
fi

if [[ $1 && $1 == '--mod' ]];then
    if [ ! $(id -u) = 0 ];then
        echo "!!! need be root, your id -u is: $(id -u)"
        exit;
    fi
    if [[ -d /tmp/ansible ]];then
        git -C /tmp/ansible fetch --all
        git -C /tmp/ansible reset --hard origin/master
    else
        git -C /tmp clone git@github.com:ansible/ansible.git
    fi
    cp -rf /tmp/ansible/lib/ansible/modules/* /usr/lib/python2.7/dist-packages/ansible/modules/
fi

if [[ $1 && $1 == '--self' ]];then
    git -C $HOME/.vagbook-cli fetch --all
    git -C $HOME/.vagbook-cli reset --hard origin/master
    chmod 755 ~/.vagbook-cli/bin/*
fi

sudo -i -u "$VAGBOOK_MASTER" git -C ./vagbook fetch --all
sudo -i -u "$VAGBOOK_MASTER" git -C ./vagbook reset --hard origin/master
